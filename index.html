<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>GSN WebGIS PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
html,body{margin:0;height:100%;font-family:sans-serif;}
#map{height:100%;}

/* Sidebar */
.sidebar{
position:absolute;
top:0;
left:-280px;
width:250px;
height:100%;
background:#111;
color:white;
padding:20px;
transition:.3s;
z-index:1000;
overflow:auto;
}
.sidebar.active{left:0;}

.toggle-btn{
position:absolute;
top:15px;
left:15px;
background:white;
padding:8px 10px;
border-radius:6px;
cursor:pointer;
z-index:1100;
}

/* Search */
.search-container{
position:absolute;
top:15px;
right:15px;
z-index:1100;
width:260px;
}
.search-container input{
width:100%;
padding:8px 35px 8px 10px;
border-radius:6px;
border:none;
box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.clear-btn{
position:absolute;
right:10px;
top:8px;
cursor:pointer;
}

/* Suggestion dropdown */
.suggestions{
background:white;
max-height:200px;
overflow:auto;
border-radius:0 0 6px 6px;
box-shadow:0 2px 6px rgba(0,0,0,.3);
}
.suggestions div{
padding:8px;
cursor:pointer;
}
.suggestions div:hover{
background:#eee;
}
</style>
</head>
<body>

<div id="map"></div>

<div class="toggle-btn" id="toggleBtn">☰</div>

<div class="sidebar" id="sidebar">
<h3>Basemap</h3>
<label><input type="radio" name="basemap" value="osm" checked> OpenStreetMap</label><br>
<label><input type="radio" name="basemap" value="sat"> Satellite</label>

<hr>

<h3>Layer</h3>
<div id="layerList"></div>
</div>

<div class="search-container">
<input type="text" id="searchInput" placeholder="Cari lokasi...">
<span class="clear-btn" id="clearBtn">✖</span>
<div class="suggestions" id="suggestions"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* ================= MAP ================= */
var map = L.map('map',{zoomControl:false})
.setView([-2.5,118],5);

/* ================= BASEMAP ================= */
var osm = L.tileLayer(
'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'
);

var satellite = L.tileLayer(
'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
);

var currentBase = osm.addTo(map);

document.querySelectorAll('input[name="basemap"]').forEach(r=>{
r.addEventListener('change',function(){
map.removeLayer(currentBase);
currentBase = this.value==="osm"?osm:satellite;
currentBase.addTo(map);
});
});

/* ================= SIDEBAR ================= */
var sidebar=document.getElementById("sidebar");
var toggle=document.getElementById("toggleBtn");

toggle.onclick=function(){
sidebar.classList.add("active");
toggle.style.display="none";
};

map.on("click",function(){
sidebar.classList.remove("active");
toggle.style.display="block";
});

/* ================= SEARCH AUTOGUIDE ================= */
var searchInput=document.getElementById("searchInput");
var suggestions=document.getElementById("suggestions");

searchInput.addEventListener("input",function(){
let query=this.value;
if(query.length<3){
suggestions.innerHTML="";
return;
}

fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}`)
.then(res=>res.json())
.then(data=>{
suggestions.innerHTML="";
data.slice(0,5).forEach(place=>{
let div=document.createElement("div");
div.textContent=place.display_name;
div.onclick=function(){
map.setView([place.lat,place.lon],13,{animate:true});
suggestions.innerHTML="";
searchInput.value=place.display_name;
};
suggestions.appendChild(div);
});
});
});

document.getElementById("clearBtn").onclick=function(){
searchInput.value="";
suggestions.innerHTML="";
};

/* ================= LOAD GEOJSON LAYER ================= */
var repo="GeoSpatialNusantara/WebGis";
var layerList=document.getElementById("layerList");

fetch(`https://api.github.com/repos/${repo}/contents/`)
.then(res=>res.json())
.then(data=>{
data.forEach(folder=>{
if(folder.type==="dir"){
fetch(folder.url)
.then(res=>res.json())
.then(files=>{
files.forEach(file=>{
if(file.name.endsWith(".geojson")){
createLayer(file);
}
});
});
}
});
});

function createLayer(file){
var label=document.createElement("label");
label.style.display="block";

var checkbox=document.createElement("input");
checkbox.type="checkbox";

label.appendChild(checkbox);
label.append(" "+file.name);

var geoLayer;

checkbox.addEventListener("change",function(){
if(this.checked){
fetch(file.download_url)
.then(res=>res.json())
.then(data=>{
geoLayer=L.geoJSON(data,{
style:{
color:"#00ffff",
weight:2
}
}).addTo(map);

map.fitBounds(geoLayer.getBounds());
});
}else{
map.removeLayer(geoLayer);
}
});

layerList.appendChild(label);
}
</script>

</body>
</html>
